import{c as O}from"./include.dom-fa565471.js";function B(i){const s=atob(i.split(",")[1]),v=i.match(/:([a-z\/\-]+);/)[1];let d=new Uint8Array(s.length);for(let c=0;c<s.length;c++)d[c]=s.charCodeAt(c);return new Blob([d],{type:v})}function _(i=0){let s=new Date;i>0&&s.setDate(s.getDate()-i);const v=s.getFullYear(),d=("0"+(s.getMonth()+1)).slice(-2),c=("0"+s.getDate()).slice(-2),w=("0"+s.getHours()).slice(-2),h=("0"+s.getMinutes()).slice(-2),p=("0"+s.getSeconds()).slice(-2);return v+"-"+d+"-"+c+" "+w+":"+h+":"+p}function j(i){i.style.height="0",i.style.height=i.scrollHeight+10+"px"}const $={liveDom:{base:O.base(),contentPanel:O.contentPanel(),__contentPanel:{__history:{},__search:{},__tmp:{}},__previewPanel:{}},init:async function(){this.config=await window.electron.ipcRenderer.invoke("get-config"),this.windowControl(),this.contentPanel()},windowControl:function(){this.liveDom.base.querySelector("div#close-win > button")?.addEventListener("click",()=>{window.electron.ipcRenderer.send("window-hide","clipboard")}),this.liveDom.base.querySelector("div#maximize-win button")?.addEventListener("click",()=>{window.electron.ipcRenderer.send("window-maximize","clipboard")}),this.liveDom.base.querySelector("div#minimize-win button")?.addEventListener("click",()=>{window.electron.ipcRenderer.send("window-minize","clipboard")});const i=this.liveDom.base.querySelector("div#fixation-win button");this.config?.window?.clipboard.isFixation&&(i.classList.add("active"),i.title="ウィンドウの固定を解除",i.ariaLabel="ウィンドウの固定を解除"),i.addEventListener("click",()=>{window.electron.ipcRenderer.invoke("clipboard-win-show-top").then(s=>{s?(i.classList.add("active"),i.title="ウィンドウの固定を解除",i.ariaLabel="ウィンドウの固定を解除"):(i.classList.remove("active"),i.title="ウィンドウを最前面に固定",i.ariaLabel="ウィンドウを最前面に固定")})}),document.getElementById("app")?.append(this.liveDom.base)},contentPanel:async function(){this.liveDom.__contentPanel.history=this.liveDom.contentPanel.querySelector("div.content.history"),this.liveDom.__contentPanel.__history.recordList=this.liveDom.__contentPanel.history.querySelector("ul.record-list"),this.liveDom.__contentPanel.search=this.liveDom.contentPanel.querySelector("div.content.search"),this.liveDom.__contentPanel.__search.recordList=this.liveDom.__contentPanel.search.querySelector("ul.record-list"),this.liveDom.__contentPanel.tmp=this.liveDom.contentPanel.querySelector("div.content.tmp"),this.liveDom.__contentPanel.__tmp.recordList=this.liveDom.__contentPanel.tmp.querySelector("ul.record-list"),this.liveDom.previewPanel=this.liveDom.contentPanel.querySelector("div.preview-panel"),this.liveDom.__previewPanel.clipText=this.liveDom.contentPanel.querySelector("#preview-clip-text"),this.liveDom.__previewPanel.clipHtml=this.liveDom.contentPanel.querySelector("#preview-clip-html"),this.liveDom.__previewPanel.clipImage=this.liveDom.contentPanel.querySelector("#preview-clip-image");const i={},s=15,v={history:s,search:s,tmp:s},d={history:!1,search:!1,tmp:!1},c=this.liveDom.__contentPanel.__history.recordList.querySelector("li.no-data-record"),w=this.liveDom.__contentPanel.__search.recordList.querySelector("li.no-data-record"),h=this.liveDom.__contentPanel.__tmp.recordList.querySelector("li.no-data-record"),p=()=>{Object.entries(this.liveDom.__previewPanel).forEach(e=>{e[1].parentElement.classList.add("hide"),e[1].parentElement.inert=!0})};[...this.liveDom.contentPanel.querySelectorAll("div.tab-labels input.tab")].forEach(e=>{e.addEventListener("click",()=>{const t=this.liveDom.contentPanel.querySelector("div.tab-content div.content.show");t.classList.remove("show"),t.inert=!0;const r=this.liveDom.contentPanel.querySelector(`div.tab-content div.${e.value}`);r.classList.add("show"),r.inert=!1,e.value==="history"&&i.history?i.history.click():e.value==="search"&&i.search?i.search.click():e.value==="tmp"&&i.tmp?i.tmp.click():p()})});let x="";const b=(e,t,r,o=!1)=>{const n=document.createElement("li"),l=document.createElement("span"),m=document.createElement("span"),L=document.createElement("button");if(n.tabIndex=0,n.classList.add("record","animate__animated","animate__fadeInLeft"),n.dataset.rowId=`${e}`,m.classList.add("operation"),L.classList.add("copy"),L.title="クリップボードに送る",L.ariaLabel="クリップボードに送る",L.innerHTML='<i class="fa-solid fa-copy"></i>',L.addEventListener("click",()=>{window.electron.ipcRenderer.invoke("update-clipboard-write-time").then(()=>{window.electron.ipcRenderer.send("clipboard-write",[t[0][0],t[0][1]])})}),n.addEventListener("contextmenu",a=>{window.electron.ipcRenderer.send("clip-hist-copy",{rowId:Number(a.currentTarget.dataset.rowId),clips:t,pos:{x:a.x,y:a.y},type:r})}),n.addEventListener("dblclick",a=>{this.liveDom.contentPanel.querySelector("#toggle-preview-panel").click(),a.currentTarget.click()}),n.addEventListener("click",a=>{r==="history"&&i.history?i.history.classList.remove("click"):r==="search"&&i.search?i.search.classList.remove("click"):r==="tmp"&&i.tmp&&i.tmp.classList.remove("click"),a.currentTarget.classList.add("click"),i[r]=a.currentTarget,p(),t.forEach(u=>{if(u[0]==="text/plain")this.liveDom.__previewPanel.clipText.value=u[1],(this.liveDom.__previewPanel.clipText?.parentElement).classList.remove("hide"),(this.liveDom.__previewPanel.clipText?.parentElement).inert=!1,j(this.liveDom.__previewPanel.clipText);else if(u[0]==="text/html")this.liveDom.__previewPanel.clipHtml.innerHTML=u[1],this.liveDom.__previewPanel.clipImage.dataset.htmlSource=u[1],(this.liveDom.__previewPanel.clipHtml?.parentElement).classList.remove("hide"),(this.liveDom.__previewPanel.clipHtml?.parentElement).inert=!1;else if(u[0].indexOf("image/")>=0){const q=document.createElement("img");q.alt="画像",q.src=u[1],this.liveDom.__previewPanel.clipImage.innerHTML="",this.liveDom.__previewPanel.clipImage.append(q),(this.liveDom.__previewPanel.clipImage?.parentElement).classList.remove("hide"),(this.liveDom.__previewPanel.clipImage?.parentElement).inert=!1}})}),t[0][0]==="text/plain"&&typeof t[0][1]=="string")l.textContent=t[0][1],l.title=t[0][1],l.classList.add("view-text");else if(t[0][0]==="text/html"&&typeof t[0][1]=="string"){let a=!1;t.forEach(u=>{u[0].indexOf("image/")&&(a=!0)}),a?(l.innerHTML=t[0][1],l.title="画像",l.classList.add("view-img")):(l.textContent=t[0][1],l.title=t[0][1],l.classList.add("view-text"))}else if(t[0][0].indexOf("image/")>=0){const a=document.createElement("img");a.alt="画像",a.src=window.URL.createObjectURL(B(t[0][1])),l.appendChild(a),l.classList.add("view-img")}n.appendChild(l),m.appendChild(L),n.appendChild(m);const T=o?"beforeend":"afterbegin";switch(r){case"history":this.liveDom.__contentPanel.__history.recordList?.insertAdjacentElement(T,n);break;case"search":this.liveDom.__contentPanel.__search.recordList?.insertAdjacentElement(T,n);break;case"tmp":this.liveDom.__contentPanel.__tmp.recordList?.insertAdjacentElement(T,n)}},g=(e,t,r=!1)=>{e.forEach(o=>{const n=[];for(let[l,m]of Object.entries(o))l==="text"&&typeof m=="string"?n.push(["text/plain",m]):l==="html"&&typeof m=="string"?n.push(["text/html",m]):l==="rtf"&&typeof m=="string"?n.push(["text/rtf",m]):l==="image"&&typeof m=="string"&&n.push(["image/png",m]);b(o.id,n,t,r)})};window.electron.ipcRenderer.invoke("get-clipboard",{type:"history",offset:0,limit:v.history}).then(e=>{e.length>0&&(c.classList.add("hide"),c.inert=!0,g(e,"history")),e.length<s&&(d.history=!0)}),window.electron.ipcRenderer.invoke("get-clipboard",{type:"tmp",offset:0,limit:v.tmp}).then(e=>{e.length>0&&(h.classList.add("hide"),h.inert=!0,g(e,"tmp")),e.length<s&&(d.tmp=!0)});const A=async()=>{const e=await window.electron.ipcRenderer.invoke("clipboard-read");if(e.length===0)return;if(x===e[0][1])return;if(e.length===1&&e[0][0]==="text/rtf")return;x=e[0][1];const t=await window.electron.ipcRenderer.invoke("clipboard-insert-db",e);t&&b(t,e,"history")};window.electron.ipcRenderer.on("clipboard-change",()=>{this.liveDom.__contentPanel.__history.recordList?.childElementCount===1&&(c.classList.add("hide"),c.inert=!0),A()}),window.electron.ipcRenderer.on("update-clipboard-saved",(e,t)=>{this.liveDom.__contentPanel.__tmp.recordList?.childElementCount===1&&(h.classList.add("hide"),h.inert=!0),b(t.insertId,t.clips,"tmp")}),this.liveDom.contentPanel.querySelector("#clip-history-all-del-btn").addEventListener("click",async()=>{await window.electron.ipcRenderer.invoke("clipboard-history-all-delete")&&this.liveDom.__contentPanel.__history.recordList?.querySelectorAll("li.record").forEach(t=>{t.classList.replace("animate__fadeInLeft","animate__fadeOutUp"),setTimeout(()=>{t.remove()},500),i.history=void 0,c.classList.remove("hide"),c.inert=!1,p()})}),this.liveDom.contentPanel.querySelector("#clip-saved-all-del-btn").addEventListener("click",async()=>{await window.electron.ipcRenderer.invoke("clipboard-saved-all-delete")&&this.liveDom.__contentPanel.__tmp.recordList?.querySelectorAll("li.record").forEach(t=>{t.classList.replace("animate__fadeInLeft","animate__fadeOutUp"),setTimeout(()=>{t.remove()},500),i.tmp=void 0,h.classList.remove("hide"),h.inert=!1,p()})}),this.liveDom.previewPanel.querySelector("#preview-clip-text-copy").addEventListener("click",async()=>{await window.electron.ipcRenderer.invoke("update-clipboard-write-time"),window.electron.ipcRenderer.send("clipboard-write",["text/plain",this.liveDom.__previewPanel.clipText?.value,!1])}),this.liveDom.previewPanel.querySelector("#preview-clip-html-copy").addEventListener("click",async()=>{await window.electron.ipcRenderer.invoke("update-clipboard-write-time"),window.electron.ipcRenderer.send("clipboard-write",["text/html",this.liveDom.__previewPanel.clipHtml?.innerHTML])}),this.liveDom.previewPanel.querySelector("#preview-clip-image-copy").addEventListener("click",async()=>{await window.electron.ipcRenderer.invoke("update-clipboard-write-time");const e=this.liveDom.__previewPanel.clipImage.childNodes[0].src;window.electron.ipcRenderer.send("clipboard-write",["image/png",e])}),window.electron.ipcRenderer.on("deleted-record",(e,t)=>{if(t.type==="history")[this.liveDom.__contentPanel.__history.recordList,this.liveDom.__contentPanel.__tmp.recordList].forEach((r,o)=>{const n=r.querySelector(`li.record[data-row-id='${t.rowId}']`);n&&(n.classList.replace("animate__fadeInLeft","animate__fadeOutUp"),o===0&&Number(i.history?.dataset.rowId)===t.rowId?(i.history=void 0,p()):o===1&&Number(i.search?.dataset.rowId)===t.rowId&&(i.search=void 0,p()),setTimeout(()=>{n.remove(),r.childElementCount===1&&o===0?c.classList.remove("hide"):r.childElementCount===1&&o===1&&w.classList.remove("hide")},500))});else if(t.type==="tmp"){const r=this.liveDom.__contentPanel.__tmp.recordList.querySelector(`li.record[data-row-id='${t.rowId}']`);r?.classList.replace("animate__fadeInLeft","animate__fadeOutUp"),i.tmp?.dataset.rowId===r?.dataset.rowId&&(i.tmp=void 0,p()),setTimeout(()=>{r?.remove(),this.liveDom.__contentPanel.__tmp.recordList?.childElementCount===1&&h.classList.remove("hide")},500)}});const E=this.liveDom.__contentPanel.search.querySelector("#history-search-text"),R=this.liveDom.__contentPanel.search.querySelector("#history-search-institution"),y=this.liveDom.__contentPanel.search.querySelector("div.select-time-limit"),I=y.querySelector("#search-start-time-limit"),H=y.querySelector("#search-end-time-limit"),M=this.liveDom.__contentPanel.search.querySelector("#search-start-time-limit"),U=this.liveDom.__contentPanel.search.querySelector("#search-end-time-limit"),k=this.liveDom.__contentPanel.search.querySelector("#history-search-image"),D=(e,t=0)=>{this.liveDom.__contentPanel.__search.recordList?.querySelectorAll("li.record").forEach(o=>{o.classList.replace("animate__fadeInLeft","animate__fadeOutUp"),setTimeout(()=>{o.remove()},400),i.search=void 0,w.classList.remove("hide"),p()});let r=!1;if(e.currentTarget.id==="history-search-text"&&(r=e.isComposing),!r&&(E.value!==""||k.checked)){let o=_().split(" ")[0]+" 23:59",n="";switch(R.value){case"today":n=_().split(" ")[0]+" 00:00";break;case"yesterday":n=_(1).split(" ")[0]+" 00:00";break;case"2-days-ago":n=_(2).split(" ")[0]+" 00:00";break;case"3-days-ago":n=_(3).split(" ")[0]+" 00:00";break;case"a-week-ago":n=_(7).split(" ")[0]+" 00:00";break;case"2-week-ago":n=_(14).split(" ")[0]+" 00:00";break;case"3-week-ago":n=_(21).split(" ")[0]+" 00:00";break;case"time-limit":n=I.value,o=H.value;break;case"all-sadness":n="2000-01-01 00:00";break}window.electron.ipcRenderer.invoke("clip-history-search",{string:E.value,image:k.checked,startDate:n,endDate:o,offset:t}).then(l=>{l&&l.length>0&&(w.classList.add("hide"),w.inert=!0,i.search=void 0,p(),g(l,"search"))})}else w.classList.remove("hide"),w.inert=!1};M.value=_().split(" ")[0]+" 00:00",U.value=_().split(" ")[0]+" 23:59",R.addEventListener("change",e=>{e.currentTarget.value==="time-limit"?(y.classList.add("show"),y.inert=!1):y.classList.contains("show")&&(y.classList.remove("show"),y.inert=!0),e.currentTarget.value!=="time-limit"&&D(e)}),I.addEventListener("change",D,!1),H.addEventListener("change",D,!1),k.addEventListener("change",D,!1),E.addEventListener("keyup",D,!1);const f={history:!1,search:!1,tmp:!1};this.liveDom.__contentPanel.__history.recordList.addEventListener("scroll",()=>{const e=this.liveDom.__contentPanel.__history.recordList?.scrollHeight||0,t=this.liveDom.__contentPanel.__history.recordList?.scrollTop||0,r=this.liveDom.__contentPanel.__history.recordList?.clientHeight||0;e-t<=r+10&&!f.history&&!d.history&&(f.history=!0,console.log("scroll"),window.electron.ipcRenderer.invoke("get-clipboard",{type:"history",offset:v.history,limit:s}).then(o=>{o.length>0&&(c.classList.add("hide"),c.inert=!0,g(o,"history",!0)),o.length<s&&(d.history=!0),v.history+=s,f.history=!1}))}),this.liveDom.__contentPanel.__search.recordList.addEventListener("scroll",()=>{const e=this.liveDom.__contentPanel.__search.recordList?.scrollHeight||0,t=this.liveDom.__contentPanel.__search.recordList?.scrollTop||0,r=this.liveDom.__contentPanel.__search.recordList?.clientHeight||0;e-t<=r&&!f.search&&!d.search&&(f.search=!0)}),this.liveDom.__contentPanel.__tmp.recordList.addEventListener("scroll",()=>{const e=this.liveDom.__contentPanel.__tmp.recordList?.scrollHeight||0,t=this.liveDom.__contentPanel.__tmp.recordList?.scrollTop||0,r=this.liveDom.__contentPanel.__tmp.recordList?.clientHeight||0;e-t<=r&&!f.tmp&&!d.tmp&&(f.tmp=!0,window.electron.ipcRenderer.invoke("get-clipboard",{type:"tmp",offset:v.tmp,limit:s}).then(o=>{o.length>0&&(h.classList.add("hide"),h.inert=!0,g(o,"tmp",!0)),o.length<s&&(d.tmp=!0),v.tmp+=s,f.tmp=!1}))});const S=this.liveDom.contentPanel.querySelector("span.resize-bar"),P=this.liveDom.contentPanel.querySelector("div.tab-content > div.content-wrap"),C=this.liveDom.contentPanel.querySelector("div.tab-content > div.preview-panel");this.liveDom.contentPanel.querySelector("#toggle-preview-panel").addEventListener("click",e=>{e.stopPropagation(),e.currentTarget.dataset.isShow==="false"?(e.currentTarget.innerHTML='<i class="fa-solid fa-angles-left"></i>',e.currentTarget.title="プレビューパネルを閉じる",e.currentTarget.ariaLabel="プレビューパネルを閉じる",e.currentTarget.dataset.isShow="true",P.classList.add("resize"),S.classList.add("show"),C.classList.add("show"),window.electron.ipcRenderer.send("resize-aspect16/9-win",!0)):(e.currentTarget.innerHTML='<i class="fa-solid fa-arrow-right-to-bracket"></i>',e.currentTarget.title="保存されたクリップボードのプレビューを表示",e.currentTarget.ariaLabel="保存されたクリップボードのプレビューを表示",e.currentTarget.dataset.isShow="false",P.classList.remove("resize"),P.style.removeProperty("flex-basis"),S.classList.remove("show"),C.classList.remove("show"),window.electron.ipcRenderer.send("resize-aspect16/9-win",!1))});const z=e=>{P.style.flexBasis=`${e.x}px`};S.addEventListener("mousedown",()=>{document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",z,!1)},!1)}),this.liveDom.base.querySelector("main#insert-panel").insertAdjacentElement("beforeend",this.liveDom.contentPanel)}};document.addEventListener("DOMContentLoaded",()=>{$.init()});
